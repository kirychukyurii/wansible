---
- name: Install PostgreSQL 15 and timescaledb packages
  apt:
    name:
      - postgresql-15
      - webitel-postgresql-15
      - timescaledb-2-postgresql-15
    update_cache: no
  when: inventory_hostname in groups['postgresql']

- name: Execute timescaledb-tune
  shell: timescaledb-tune --quiet --yes
  when: inventory_hostname in groups['postgresql_main']

- name: Enable PostgreSQL at startup (systemd)
  systemd:
    name: postgresql
    enabled: yes
    daemon_reload: true
    state: restarted
  when:
    - ansible_service_mgr == "systemd"